<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <title>비니의 말</title>

    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css"
    />

    <style>
      :root {
        --bg-green: #e9f7d9;
        --card-radius: 20px;
        --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        --text-gray: #888888;
        --primary-green: #4caf50;
      }

      * {
        box-sizing: border-box;
      }

      /* ✅ body는 배경 + 폰트만 담당, 가운데 정렬은 .app이 담당 */
      body {
        margin: 0;
        background: var(--bg-green);
        font-family: "Pretendard Variable", Pretendard, -apple-system,
          BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI",
          "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic",
          "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
        overflow: hidden; /* 전체 페이지 스크롤 방지 */
      }

      /* ✅ 화면 전체를 쓰면서 카드 세로/가로 가운데 정렬 */
      .app {
        width: 100%;
        max-width: 420px;          /* 카드 최대 폭 */
        margin: 0 auto;
        min-height: 100vh;         /* 화면 높이 전체 */
        display: flex;
        align-items: center;       /* 세로 가운데 */
        justify-content: center;   /* 가로 가운데 */
        padding: 8px 16px;         /* 화면 가장자리 여백 최소 */
      }

      .card {
        background: #ffffff;
        border-radius: var(--card-radius);
        padding: 18px 18px 18px;
        box-shadow: var(--card-shadow);
        width: 100%;
        max-height: calc(100vh - 16px); /* 혹시 몰라 세로 오버플로우 방지 */
        display: flex;
        flex-direction: column;
      }

      .content {
        height: 230px;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
      }

      .date {
        font-size: 14px;
        color: var(--text-gray);
        margin-bottom: 10px;
      }

      .quote-wrapper {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
      }

      .quote-block {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
      }

      .quote-title {
        font-size: 13px;
        font-weight: 700;
        color: var(--primary-green);
        margin-bottom: 6px;
      }

      .quote-main {
        font-size: 20px;
        line-height: 1.7;
        word-break: keep-all;
        white-space: pre-wrap;
        max-height: 180px;
        overflow-y: auto;
        padding: 0 4px;
        text-align: center;
      }

      .quote-main.loading {
        color: #aaaaaa;
        font-style: normal;
      }

      .buttons {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 8px;
      }

      .btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        width: 100%;
        padding: 13px 18px;
        border-radius: 999px;
        border: none;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.05s ease-out, box-shadow 0.1s ease-out;
      }

      .btn:active {
        transform: translateY(1px);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.12);
      }

      .btn-outline {
        background: #ffffff;
        border: 1px solid #dddddd;
        color: #333333;
      }

      .btn-primary {
        background: var(--primary-green);
        color: #ffffff;
      }

      .btn-primary.copied {
        font-weight: 700;
      }

      .btn-primary:disabled,
      .btn-outline:disabled {
        opacity: 0.6;
        cursor: default;
        transform: none;
        box-shadow: none;
      }

      .icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }

      .icon-svg {
        width: 20px;
        height: 20px;
        display: block;
      }

      .icon-check {
        display: none;
      }

      .divider {
        width: 100%;
        height: 1px;
        background: #e4e4e4;
        margin: 16px 0 12px;
      }

      .adventure-block {
        text-align: center;
        padding-top: 2px;
        padding-bottom: 2px;
      }

      .adventure-title {
        font-size: 13px;
        font-weight: 700;
        color: var(--primary-green);
        margin-bottom: 6px;
      }

      .adventure-text {
        font-size: 14px;
        line-height: 1.6;
        color: #555555;
        word-break: keep-all;
        white-space: pre-wrap;
        max-height: 80px;
        overflow-y: auto;
        padding: 0 4px;
        margin-bottom: 8px;
      }

      .adventure-footnote {
        font-size: 12px;
        font-weight: 700;
        color: #777777;
      }
    </style>
  </head>
  <body>
    <div class="app">
      <div class="card">
        <div class="content">
          <div id="today" class="date"></div>

          <div class="quote-wrapper">
            <div class="quote-block">
              <div class="quote-title">비니가 말했어요</div>
              <div id="quoteText" class="quote-main">불러오는 중...</div>
            </div>
          </div>
        </div>

        <div class="buttons">
          <button id="refreshBtn" class="btn btn-outline">
            <span class="icon">
              <svg class="icon-svg" viewBox="0 0 24 24" aria-hidden="true">
                <path
                  d="M4 4v6h6M20 20v-6h-6M5 19a8 8 0 0 0 13-3M19 5a8 8 0 0 0-13 3"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </span>
            <span>다시 말걸어보기</span>
          </button>

          <button id="copyBtn" class="btn btn-primary">
            <span class="icon">
              <svg
                class="icon-svg icon-clipboard"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <rect
                  x="9"
                  y="9"
                  width="11"
                  height="11"
                  rx="2"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                />
                <path
                  d="M5 15V5a2 2 0 0 1 2-2h10"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                />
              </svg>
              <svg
                class="icon-svg icon-check"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  d="M20 6L9 17l-5-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </span>
            <span id="copyBtnLabel">비니의 말 기억하기</span>
          </button>
        </div>

        <div class="divider"></div>
        <div class="adventure-block">
          <div class="adventure-title">오늘의 모험</div>
          <div id="subLabel" class="adventure-text"></div>
          <div class="adventure-footnote">비니가 응원할게!</div>
        </div>
      </div>
    </div>

    <script>
      const API_URL =
        "https://script.google.com/macros/s/AKfycbxiMBfkCL43Fn0Zj2-6ezKw0f2duls4JKAuseTya1e0gVq2ecxOESLTqFmoqQv-LyzFgQ/exec";

      function updateToday() {
        const d = new Date();
        const yyyy = d.getFullYear();
        const mm = String(d.getMonth() + 1).padStart(2, "0");
        const dd = String(d.getDate()).padStart(2, "0");
        document.getElementById("today").textContent = `${yyyy}.${mm}.${dd}`;
      }

      function loadJsonp(url) {
        const script = document.createElement("script");
        script.src = url;
        script.async = true;
        document.body.appendChild(script);
      }

      function requestInitial() {
        const quoteEl = document.getElementById("quoteText");
        quoteEl.textContent = "생각하는 중...";
        quoteEl.classList.add("loading");

        loadJsonp(API_URL + "?action=initial&callback=handleInitial");
      }

      function handleInitial(data) {
        const quoteEl = document.getElementById("quoteText");
        const subLabelEl = document.getElementById("subLabel");

        quoteEl.classList.remove("loading");
        quoteEl.textContent = (data.quote || "").trim();
        if (subLabelEl) {
          subLabelEl.textContent = (data.adventure || "").trim();
        }
        updateToday();
      }

      function requestNewQuote() {
        const quoteEl = document.getElementById("quoteText");

        quoteEl.textContent = "생각하는 중...";
        quoteEl.classList.add("loading");

        loadJsonp(API_URL + "?action=newQuote&callback=handleNewQuote");
      }

      function handleNewQuote(data) {
        const quoteEl = document.getElementById("quoteText");
        quoteEl.classList.remove("loading");
        quoteEl.textContent = (data.quote || "").trim();
        updateToday();
      }

      function setupCopyButton() {
        const quoteEl = document.getElementById("quoteText");
        const copyBtn = document.getElementById("copyBtn");
        const clipboardIcon = document.querySelector(".icon-clipboard");
        const checkIcon = document.querySelector(".icon-check");
        const copyLabel = document.getElementById("copyBtnLabel");

        function showCopiedState() {
          if (copyBtn.classList.contains("copied")) return;

          copyBtn.classList.add("copied");
          if (clipboardIcon && checkIcon && copyLabel) {
            clipboardIcon.style.display = "none";
            checkIcon.style.display = "block";
            copyLabel.textContent = "복사 완료!";
          }

          setTimeout(() => {
            copyBtn.classList.remove("copied");
            if (clipboardIcon && checkIcon && copyLabel) {
              clipboardIcon.style.display = "block";
              checkIcon.style.display = "none";
              copyLabel.textContent = "비니의 말 기억하기";
            }
          }, 1200);
        }

        copyBtn.addEventListener("click", () => {
          const text = quoteEl.textContent || "";

          if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard
              .writeText(text)
              .then(showCopiedState)
              .catch(showCopiedState);
          } else {
            const textarea = document.createElement("textarea");
            textarea.value = text;
            textarea.style.position = "fixed";
            textarea.style.left = "-9999px";
            document.body.appendChild(textarea);
            textarea.focus();
            textarea.select();
            try {
              document.execCommand("copy");
            } catch (e) {}
            document.body.removeChild(textarea);
            showCopiedState();
          }
        });
      }

      document.addEventListener("DOMContentLoaded", () => {
        updateToday();
        setupCopyButton();
        requestInitial();

        const refreshBtn = document.getElementById("refreshBtn");
        refreshBtn.addEventListener("click", requestNewQuote);
      });
    </script>
  </body>
</html>
